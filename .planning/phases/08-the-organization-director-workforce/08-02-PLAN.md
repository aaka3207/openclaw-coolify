---
phase: 08-the-organization-director-workforce
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified: []
autonomous: false
user_setup:
  - service: claude-code
    why: "Automation Supervisor execution layer — Claude Code CLI on server"
    env_vars: []
    dashboard_config:
      - task: "Authenticate Claude Code on Mac first (claude login), then copy ~/.claude/ to server"
        location: "Terminal on Mac + SSH to server"

must_haves:
  truths:
    - "Claude Code CLI is installed on the server at /data/.local/bin/claude"
    - "Claude Code is authenticated (can run claude -p without auth errors)"
    - "Authentication persists across container restarts (stored on persistent volume)"
  artifacts:
    - path: "/data/.local/bin/claude"
      provides: "Claude Code CLI binary"
  key_links:
    - from: "/data/.claude/"
      to: "/data/.local/bin/claude"
      via: "OAuth credentials read by CLI"
      pattern: "credentials"
---

<objective>
Install Claude Code CLI on the server and copy authentication from Mac.

Purpose: The Automation Supervisor needs Claude Code as its execution layer for deep diagnosis and repair tasks. Claude Code uses Ameer's Claude Max plan (no API token cost). Authentication requires copying ~/.claude/ from Mac to the server container's persistent volume.

Output: Working, authenticated Claude Code CLI at /data/.local/bin/claude on the server.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/08-the-organization-director-workforce/08-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Claude Code CLI on server via SSH</name>
  <files></files>
  <action>
SSH into the server and install Claude Code inside the running OpenClaw container.

Step 1: Find the running container name:
```bash
sshpass -p '@pack86N5891' ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password ameer@192.168.1.100 \
  "sudo docker ps --filter 'name=openclaw' --format '{{.Names}}' | head -1"
```

Step 2: Install Claude Code inside the container (installs to /data/.local/bin/claude which is on persistent volume):
```bash
sshpass -p '@pack86N5891' ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password ameer@192.168.1.100 \
  "sudo docker exec CONTAINER_NAME bash -c 'curl -fsSL https://claude.ai/install.sh | bash'"
```

Step 3: Verify installation:
```bash
sshpass -p '@pack86N5891' ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password ameer@192.168.1.100 \
  "sudo docker exec CONTAINER_NAME bash -c '/data/.local/bin/claude --version'"
```

Step 4: Disable auto-updates to prevent version drift (per research pitfall #8):
```bash
sshpass -p '@pack86N5891' ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password ameer@192.168.1.100 \
  "sudo docker exec CONTAINER_NAME bash -c 'echo DISABLE_AUTOUPDATER=1 >> /data/.claude/settings.env 2>/dev/null || mkdir -p /data/.claude && echo DISABLE_AUTOUPDATER=1 > /data/.claude/settings.env'"
```

NOTE: /data/.local/bin/ is already on PATH via bootstrap.sh line 5. No PATH changes needed.
  </action>
  <verify>
```bash
sshpass -p '@pack86N5891' ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password ameer@192.168.1.100 \
  "sudo docker exec CONTAINER_NAME bash -c 'claude --version'"
```
Should output a version string (e.g., `claude 1.x.x`).
  </verify>
  <done>Claude Code CLI installed at /data/.local/bin/claude on the server, auto-updates disabled.</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 2: Copy Claude Code auth credentials from Mac to server</name>
  <files></files>
  <action>
The user (Ameer) must copy authenticated Claude credentials from Mac to server. This requires the Mac to have an active Claude Code login. Present the following instructions to the user and wait for confirmation.
  </action>
  <verify>
After user completes the copy, run:
```bash
sshpass -p '@pack86N5891' ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password ameer@192.168.1.100 \
  "sudo docker exec CONTAINER_NAME bash -c 'claude -p \"echo hello\" --dangerously-skip-permissions --max-turns 1 --output-format json'"
```
Should return a JSON response with Claude's output.
  </verify>
  <done>Claude Code authenticated on server. `claude -p` returns valid responses.</done>
  <what-built>Claude Code CLI installed on the server but not yet authenticated.</what-built>
  <how-to-verify>
**On your Mac (if not already logged in):**
```bash
claude login
# Follow the browser OAuth flow
```

**Copy credentials to server:**
```bash
# Find the running container name
CONTAINER=$(sshpass -p '@pack86N5891' ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password ameer@192.168.1.100 \
  "sudo docker ps --filter 'name=openclaw' --format '{{.Names}}' | head -1")

# Copy the credential files (not the entire ~/.claude/ — just auth files)
scp -o StrictHostKeyChecking=no ~/.claude/.credentials.json ameer@192.168.1.100:/tmp/claude-credentials.json
scp -o StrictHostKeyChecking=no ~/.claude.json ameer@192.168.1.100:/tmp/claude-config.json

# Copy into the container's persistent volume
sshpass -p '@pack86N5891' ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password ameer@192.168.1.100 \
  "sudo docker cp /tmp/claude-credentials.json $CONTAINER:/data/.claude/.credentials.json && \
   sudo docker cp /tmp/claude-config.json $CONTAINER:/data/.claude.json && \
   rm /tmp/claude-credentials.json /tmp/claude-config.json"

# Test it works
sshpass -p '@pack86N5891' ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password ameer@192.168.1.100 \
  "sudo docker exec $CONTAINER bash -c 'claude -p \"echo hello\" --dangerously-skip-permissions --max-turns 1 --output-format json'"
```

If you see a JSON response with Claude's output, authentication is working.

**Alternative: If you prefer API key auth instead of OAuth:**
Set ANTHROPIC_API_KEY in Coolify environment variables. The Automation Supervisor's SOUL.md will reference the credential file path.
  </how-to-verify>
  <resume-signal>Type "claude auth complete" when credentials are copied and the test command succeeds, or describe any issues.</resume-signal>
</task>

</tasks>

<verification>
1. `claude --version` works inside the container
2. `claude -p "echo test" --dangerously-skip-permissions --max-turns 1` returns a response (proves auth works)
3. After container restart, `claude --version` still works (persistent volume)
</verification>

<success_criteria>
- Claude Code CLI installed at /data/.local/bin/claude
- Authentication credentials present at /data/.claude/.credentials.json (or ANTHROPIC_API_KEY set)
- `claude -p` command succeeds with a real response
- Installation survives container restarts
</success_criteria>

<output>
After completion, create `.planning/phases/08-the-organization-director-workforce/08-02-SUMMARY.md`
</output>
