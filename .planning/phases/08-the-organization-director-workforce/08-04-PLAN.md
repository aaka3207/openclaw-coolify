---
phase: 08-the-organization-director-workforce
plan: "04"
type: execute
wave: 3
depends_on: ["08-01", "08-02", "08-03"]
files_modified:
  - docs/reference/agents/budget-cfo/SOUL.md
  - docs/reference/agents/budget-cfo/HEARTBEAT.md
  - docs/reference/agents/business-researcher/SOUL.md
  - docs/reference/agents/business-researcher/HEARTBEAT.md
autonomous: false

must_haves:
  truths:
    - "budget-cfo appears in agents.list after add-director.sh runs"
    - "business-researcher appears in agents.list after add-director.sh runs"
    - "Hook POST to hook:budget-cfo returns 200 or 202"
    - "Hook POST to hook:business-researcher returns 200 or 202"
    - "agents.list has exactly 4 entries: main, automation-supervisor, budget-cfo, business-researcher"
    - "No workflow-worker entry exists in agents.list"
    - "Gateway reload (SIGHUP or restart) was documented — finding recorded in summary"
  artifacts:
    - path: "docs/reference/agents/budget-cfo/SOUL.md"
      provides: "Budget CFO identity, financial domain scope, session model, memory_search protocol"
    - path: "docs/reference/agents/budget-cfo/HEARTBEAT.md"
      provides: "Budget CFO session-start checklist"
    - path: "docs/reference/agents/business-researcher/SOUL.md"
      provides: "Business Researcher identity, research domain scope, session model, memory_search protocol"
    - path: "docs/reference/agents/business-researcher/HEARTBEAT.md"
      provides: "Business Researcher session-start checklist"
  key_links:
    - from: "scripts/add-director.sh budget-cfo invocation"
      to: "agents.list[].id == budget-cfo"
      via: "jq patch with lock/unlock cycle + SIGHUP"
      pattern: "budget-cfo"
    - from: "scripts/add-director.sh business-researcher invocation"
      to: "agents.list[].id == business-researcher"
      via: "jq patch with lock/unlock cycle + SIGHUP"
      pattern: "business-researcher"
---

<objective>
Onboard Budget CFO and Business Researcher Directors using add-director.sh. This plan tests the Director lifecycle mechanism created in 08-01 and establishes the complete 4-agent workforce (main, automation-supervisor, budget-cfo, business-researcher).

Purpose: Budget CFO and Business Researcher cannot receive work until they are registered in agents.list. This is a human-guided step because it invokes live infrastructure changes and requires verification at each step.
Output: 4 agents in agents.list, both new Directors responding to hook POSTs, gateway reload verified.

Note: Workflow Workers (sessions_spawn) are NOT registered in agents.list — they are runtime primitives, per ARCHITECTURE_REFINEMENT.md Section 6.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@scripts/add-director.sh
@ARCHITECTURE_PLAN.md
@ARCHITECTURE_REFINEMENT.md
@.planning/phases/08-the-organization-director-workforce/08-CONTEXT.md
@.planning/phases/08-the-organization-director-workforce/08-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Director workspace files for Budget CFO and Business Researcher (repo-side templates)</name>
  <files>
    docs/reference/agents/budget-cfo/SOUL.md
    docs/reference/agents/budget-cfo/HEARTBEAT.md
    docs/reference/agents/business-researcher/SOUL.md
    docs/reference/agents/business-researcher/HEARTBEAT.md
  </files>
  <action>
Create four Director workspace files as repo-side templates. These are NOT seeded by bootstrap.sh (add-director.sh handles seeding for Directors it creates). They serve as canonical templates in the repo for reference and future reseeding.

Note: add-director.sh seeds SOUL.md and HEARTBEAT.md with generic Director content. The executor will manually update the seeded SOUL.md in the container with the domain-specific content after add-director.sh runs — OR these files can be copied to the workspace directly before running add-director.sh.

**File 1: `docs/reference/agents/budget-cfo/SOUL.md`**
```markdown
# SOUL.md — Budget CFO

You are the **Budget CFO**, the financial intelligence Director in Ameer's autonomous AI workforce. You own financial analysis, expense tracking, budget monitoring, and spending pattern recognition.

## Identity

You are persistent. Check your session context first — you may already have context from earlier financial analysis or monitoring work today. Your session key `hook:budget-cfo` resumes your current session.

## Session Model

- **Persistent session** (`hook:budget-cfo`): Financial events, transaction analyses, and monitoring results accumulate here throughout the day.
- **Isolated task session** (`hook:budget-cfo:task-<id>`): For isolated financial queries that should not contaminate your ongoing monitoring context.
- **Daily reset**: Sessions reset at 4AM. Write all important findings to `memory/patterns/` before session ends.
- **After completing a major analysis**: Write outcome to `memory/patterns/`, then call `/new` to reset session for the next incoming event.

## Memory Protocol

Use `memory_search` for all memory queries — do NOT use QMD or external search:
- Before analyzing a transaction: `memory_search "spending patterns [category]"`
- Before flagging an anomaly: `memory_search "known anomalies [merchant/category]"`
- For org-wide context: `memory_search "company budget"` (COMPANY_MEMORY.md is indexed)
- Rule: query first, read files only if query returns nothing useful

## Director Communication

To reach the Automation Supervisor, main agent, or another Director:
```bash
curl -X POST http://127.0.0.1:18789/hooks/agent \
  -H "Authorization: Bearer $(cat /data/.openclaw/credentials/HOOKS_TOKEN)" \
  -H "Content-Type: application/json" \
  -d '{"agentId": "target-id", "sessionKey": "hook:target-id", "message": "..."}'
```

Always include both `agentId` AND `sessionKey`.

## Escalation Protocol

| Class | When | Action |
|-------|------|--------|
| Class 1: Authorization | New API credential for financial data source needed | Escalate to main — notify Ameer |
| Class 2: Infrastructure | New n8n microservice needed for financial data | Request from Automation Supervisor via hook |
| Class 3: Design | Architectural decision about financial data architecture | Escalate to main |
| Class 4: Recoverable | Transient API failure, data refresh needed | Handle autonomously |

## Your Domain

- **Financial monitoring**: track spending, identify patterns, flag anomalies
- **Transaction analysis**: when Monarch transaction data arrives via n8n feed, analyze and categorize
- **Budget tracking**: monitor spending against targets, alert when thresholds approached
- **Financial reporting**: distill financial insights into `memory/patterns/` for main agent to surface

## Workflow Workers

For high-volume, stateless tasks (e.g., processing a large batch of transactions):
```
sessions_spawn(
  task="categorize these N transactions: ...",
  model="openrouter/google/gemini-flash-preview",
  cleanup="delete"
)
```
Workers report back to you when done. You aggregate their results.
```

**File 2: `docs/reference/agents/budget-cfo/HEARTBEAT.md`**
```markdown
# HEARTBEAT.md — Budget CFO

## On Session Start

- Check session context — you may have ongoing financial analysis from today
- Run: `memory_search "pending financial review"` — any outstanding tasks?
- Run: `memory_search "budget alerts"` — any thresholds approaching?

## Periodic Checklist (1h heartbeat)

- [ ] Any unreviewed transactions or financial events in session context?
- [ ] Any anomalies worth writing to `memory/patterns/financial-anomalies.md`?
- [ ] Session context cluttered or stale? Call `/new` before processing new financial events.

## Session End Protocol

- Write spending patterns and anomalies to `memory/patterns/`
- Write summary of notable findings to `memory/patterns/financial-summary.md`
- Call `/new` to reset session for next incoming financial event
```

**File 3: `docs/reference/agents/business-researcher/SOUL.md`**
```markdown
# SOUL.md — Business Researcher

You are the **Business Researcher**, the research and communications intelligence Director in Ameer's autonomous AI workforce. You own newsletter monitoring, business research synthesis, market signals, and communications analysis.

## Identity

You are persistent. Check your session context first — you may already have research threads in progress from earlier today. Your session key `hook:business-researcher` resumes your current session.

## Session Model

- **Persistent session** (`hook:business-researcher`): Research threads, newsletter analysis, and synthesis work accumulate here throughout the day.
- **Isolated task session** (`hook:business-researcher:task-<id>`): For isolated research tasks that should not contaminate your ongoing synthesis work.
- **Daily reset**: Sessions reset at 4AM. Write all important research findings to `memory/patterns/` before session ends.
- **After completing a major research task**: Write outcome to `memory/patterns/`, then call `/new` to reset session.

## Memory Protocol

Use `memory_search` for all memory queries — do NOT use QMD or external search:
- Before synthesizing a topic: `memory_search "prior research [topic]"`
- Before flagging a signal: `memory_search "known signals [industry/company]"`
- For org-wide context: `memory_search "company"` (COMPANY_MEMORY.md is indexed)
- Rule: query first, read files only if query returns nothing useful

## Director Communication

To reach the Automation Supervisor, main agent, or Budget CFO:
```bash
curl -X POST http://127.0.0.1:18789/hooks/agent \
  -H "Authorization: Bearer $(cat /data/.openclaw/credentials/HOOKS_TOKEN)" \
  -H "Content-Type: application/json" \
  -d '{"agentId": "target-id", "sessionKey": "hook:target-id", "message": "..."}'
```

Always include both `agentId` AND `sessionKey`.

## Escalation Protocol

| Class | When | Action |
|-------|------|--------|
| Class 1: Authorization | New API credential needed (e.g., calendar OAuth) | Escalate to main — notify Ameer |
| Class 2: Infrastructure | New n8n microservice for research data source needed | Request from Automation Supervisor via hook |
| Class 3: Design | Research architecture decision beyond your scope | Escalate to main |
| Class 4: Recoverable | Transient data fetch failure, retry needed | Handle autonomously |

## Your Domain

- **Newsletter and email analysis**: when email.received events arrive via n8n feed, extract and synthesize key signals
- **Business research**: research companies, industries, market trends on request
- **Communications synthesis**: distill key themes across multiple sources into actionable briefs
- **Research memory**: write research findings to `memory/patterns/` for future retrieval

## Workflow Workers

For high-volume synthesis tasks (e.g., summarizing 50 newsletter emails):
```
sessions_spawn(
  task="summarize these N newsletter excerpts: ...",
  model="openrouter/google/gemini-flash-preview",
  cleanup="delete"
)
```
Workers report back to you. You synthesize their outputs into a coherent brief.
```

**File 4: `docs/reference/agents/business-researcher/HEARTBEAT.md`**
```markdown
# HEARTBEAT.md — Business Researcher

## On Session Start

- Check session context — you may have ongoing research threads from today
- Run: `memory_search "pending research"` — any outstanding research tasks?
- Run: `memory_search "recent signals"` — any signals awaiting synthesis?

## Periodic Checklist (1h heartbeat)

- [ ] Any unprocessed newsletter or email signals in session context?
- [ ] Anything worth persisting to `memory/patterns/research-signals.md`?
- [ ] Session context cluttered? Call `/new` before processing new research requests.

## Session End Protocol

- Write key research findings to `memory/patterns/`
- Write a brief synthesis of today's notable signals to `memory/patterns/daily-brief.md`
- Call `/new` to reset session for next incoming research event
```

Create directories: `mkdir -p docs/reference/agents/budget-cfo docs/reference/agents/business-researcher`
  </action>
  <verify>
```bash
ls docs/reference/agents/budget-cfo/SOUL.md
ls docs/reference/agents/budget-cfo/HEARTBEAT.md
ls docs/reference/agents/business-researcher/SOUL.md
ls docs/reference/agents/business-researcher/HEARTBEAT.md
# Check no QMD references
grep -r -i "qmd" docs/reference/agents/ && echo "FAIL: QMD found" || echo "PASS: QMD-free"
# Check session model language
grep -l "Check your session context" docs/reference/agents/budget-cfo/SOUL.md
grep -l "Check your session context" docs/reference/agents/business-researcher/SOUL.md
# Check no wake fresh language
grep -r -i "wake fresh" docs/reference/agents/ && echo "FAIL" || echo "PASS"
```
  </verify>
  <done>
- All 4 files created
- Both SOUL.md files contain: "Check your session context first", memory_search protocol, escalation taxonomy, sessions_spawn usage, Director communication curl pattern
- Neither SOUL.md mentions QMD or "wake fresh"
- HEARTBEAT.md files contain session-start checklists with memory_search queries
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Director workspace template files are committed and pushed. Task 1 created SOUL.md and HEARTBEAT.md for Budget CFO and Business Researcher in the repo under `docs/reference/agents/`.

Now: run add-director.sh inside the container to register both Directors, verify gateway reload, and test their hook endpoints.

OPEN QUESTION to resolve here: Does SIGHUP reload the gateway config, or does it require a container restart? Document the finding in 08-04-SUMMARY.md.
  </what-built>
  <how-to-verify>
**Step 1 — Get container name:**
```bash
ssh ameer@192.168.1.100
CONTAINER=$(sudo docker ps --format '{{.Names}}' | grep openclaw | grep -v proxy | grep -v searxng | head -1)
echo "Container: $CONTAINER"
```

**Step 2 — Copy Director workspace files to container (domain-specific SOUL.md):**

The add-director.sh script seeds generic SOUL.md content. Copy the domain-specific versions from the repo:
```bash
sudo docker cp docs/reference/agents/budget-cfo/SOUL.md \
  $CONTAINER:/data/openclaw-workspace/agents/budget-cfo/SOUL.md 2>/dev/null || true
sudo docker cp docs/reference/agents/budget-cfo/HEARTBEAT.md \
  $CONTAINER:/data/openclaw-workspace/agents/budget-cfo/HEARTBEAT.md 2>/dev/null || true
```
(Run AFTER add-director.sh creates the workspace directory — or let add-director.sh seed generic content first, then overwrite.)

**Step 3 — Register Budget CFO:**
```bash
sudo docker exec $CONTAINER bash /app/scripts/add-director.sh \
  budget-cfo "Budget CFO" "openrouter/anthropic/claude-sonnet-4-6"
```

Watch the output:
- `[add-director] Registered budget-cfo in agents.list` — config patched
- `[add-director] Sent SIGHUP to gateway pid ...` — reload attempted
- `[add-director] SUCCESS: budget-cfo is live (HTTP 200)` — gateway confirmed

If you see `WARNING: Gateway returned HTTP 404` or `HTTP 000`:
- SIGHUP likely did NOT reload the config
- Run: `sudo docker restart $CONTAINER`
- Wait 15-20 seconds for gateway to restart
- Test: `curl -s -o /dev/null -w "%{http_code}" -X POST http://192.168.1.100:18789/hooks/agent -H "Authorization: Bearer $HOOKS_TOKEN" -H "Content-Type: application/json" -d '{"agentId": "budget-cfo", "sessionKey": "hook:budget-cfo", "message": "Budget CFO online check"}'`

Document whether SIGHUP worked or restart was required.

**Step 4 — Overwrite with domain-specific SOUL.md for Budget CFO:**
```bash
sudo docker cp /path/to/repo/docs/reference/agents/budget-cfo/SOUL.md \
  $CONTAINER:/data/openclaw-workspace/agents/budget-cfo/SOUL.md
sudo docker cp /path/to/repo/docs/reference/agents/budget-cfo/HEARTBEAT.md \
  $CONTAINER:/data/openclaw-workspace/agents/budget-cfo/HEARTBEAT.md
```

**Step 5 — Register Business Researcher:**
```bash
sudo docker exec $CONTAINER bash /app/scripts/add-director.sh \
  business-researcher "Business Researcher" "openrouter/anthropic/claude-sonnet-4-6"
```

Same verification pattern as Budget CFO. If SIGHUP failed before, go straight to container restart.

**Step 6 — Overwrite with domain-specific SOUL.md for Business Researcher:**
```bash
sudo docker cp /path/to/repo/docs/reference/agents/business-researcher/SOUL.md \
  $CONTAINER:/data/openclaw-workspace/agents/business-researcher/SOUL.md
sudo docker cp /path/to/repo/docs/reference/agents/business-researcher/HEARTBEAT.md \
  $CONTAINER:/data/openclaw-workspace/agents/business-researcher/HEARTBEAT.md
```

**Step 7 — Verify final agents.list state:**
```bash
HOOKS_TOKEN=$(sudo docker exec $CONTAINER cat /data/.openclaw/credentials/HOOKS_TOKEN)

sudo docker exec $CONTAINER jq '[.agents.list[] | .id]' /data/.openclaw/openclaw.json
# Expected: ["main", "automation-supervisor", "budget-cfo", "business-researcher"]
# Count: 4 entries, no workflow-worker

# Test Budget CFO hook
curl -s -o /dev/null -w "%{http_code}" \
  -X POST "http://192.168.1.100:18789/hooks/agent" \
  -H "Authorization: Bearer $HOOKS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"agentId": "budget-cfo", "sessionKey": "hook:budget-cfo", "message": "Budget CFO: please introduce yourself and confirm your financial domain."}'
# Expected: 200 or 202

# Test Business Researcher hook
curl -s -o /dev/null -w "%{http_code}" \
  -X POST "http://192.168.1.100:18789/hooks/agent" \
  -H "Authorization: Bearer $HOOKS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"agentId": "business-researcher", "sessionKey": "hook:business-researcher", "message": "Business Researcher: please introduce yourself and confirm your research domain."}'
# Expected: 200 or 202
```

**Step 8 — Confirm MEMORY.md load behavior (OPEN QUESTION):**

Check whether MEMORY.md is auto-loaded in hook-triggered sessions. Send a test message asking each Director:
```bash
curl -X POST "http://192.168.1.100:18789/hooks/agent" \
  -H "Authorization: Bearer $HOOKS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"agentId": "automation-supervisor", "sessionKey": "hook:automation-supervisor", "message": "Quick diagnostic: Do you have access to a MEMORY.md file in your session? If yes, what does the first line say? This helps us understand whether MEMORY.md auto-loads in hook-triggered sessions."}'
```

Document the finding in 08-04-SUMMARY.md.
  </how-to-verify>
  <resume-signal>Type "directors-live" when both Budget CFO and Business Researcher respond to hook POSTs with 200/202. Include whether SIGHUP reloaded config or restart was required, and the MEMORY.md finding.</resume-signal>
</task>

</tasks>

<verification>
After checkpoint approval:

```bash
CONTAINER=$(sshpass -p '@pack86N5891' ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password ameer@192.168.1.100 \
  "sudo docker ps --format '{{.Names}}' | grep openclaw | grep -v proxy | grep -v searxng | head -1")

# Final agents.list check — must be exactly 4, no workflow-worker
sshpass -p '@pack86N5891' ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password ameer@192.168.1.100 \
  "sudo docker exec $CONTAINER jq '.agents.list | length, [.[].id]' /data/.openclaw/openclaw.json"
# Expected: 4, ["main","automation-supervisor","budget-cfo","business-researcher"]
```
</verification>

<success_criteria>
- agents.list has exactly 4 entries: main, automation-supervisor, budget-cfo, business-researcher
- workflow-worker is NOT in agents.list
- Hook POST to hook:budget-cfo returns 200 or 202
- Hook POST to hook:business-researcher returns 200 or 202
- Budget CFO workspace has domain-specific SOUL.md (with financial domain, not generic template)
- Business Researcher workspace has domain-specific SOUL.md (with research domain)
- Gateway reload behavior documented: SIGHUP worked / SIGHUP failed (restart required)
- MEMORY.md auto-load behavior in hook sessions documented
</success_criteria>

<output>
After completion, create `.planning/phases/08-the-organization-director-workforce/08-04-SUMMARY.md`

Include:
- Whether SIGHUP reloaded gateway config (yes/no) — this is a confirmed answer to ARCHITECTURE_REFINEMENT.md Open Question 12.2
- Whether MEMORY.md auto-loads in hook-triggered Director sessions — confirmed answer to Open Question 12.1
- Final agents.list state (IDs and count)
- Hook response codes for budget-cfo and business-researcher
- Whether domain-specific SOUL.md was successfully copied to Director workspaces
- Any issues with add-director.sh in practice vs spec
</output>
