---
phase: 08-the-organization-director-workforce
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/bootstrap.sh
autonomous: true

must_haves:
  truths:
    - "Gateway starts successfully with 4 new Director agents registered"
    - "Each Director has an isolated workspace directory with SOUL.md stub"
    - "Main agent AGENTS.md and memory/patterns/ seeding is unchanged"
    - "Config lock (chmod 444) still applied after all patches"
  artifacts:
    - path: "scripts/bootstrap.sh"
      provides: "Director agents.list jq patches + workspace seeding"
      contains: "automation-supervisor"
  key_links:
    - from: "scripts/bootstrap.sh"
      to: "openclaw.json agents.list"
      via: "jq append with idempotent check"
      pattern: 'select\(.id == "automation-supervisor"\)'
    - from: "scripts/bootstrap.sh"
      to: "/data/openclaw-workspace/agents/*/SOUL.md"
      via: "seed_agent function or mkdir+cat"
      pattern: "mkdir -p.*agents/"
---

<objective>
Register 4 Director agents in agents.list and seed their workspace directories via bootstrap.sh.

Purpose: Directors cannot receive hook messages or operate until they exist in agents.list AND have workspace directories. This is the foundation for all subsequent Phase 8 work.

Output: Updated bootstrap.sh with idempotent jq patches adding automation-supervisor, budget-cfo, business-researcher, and workflow-worker to agents.list, plus workspace directory seeding for each.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@scripts/bootstrap.sh
@ARCHITECTURE_PLAN.md
@.planning/phases/08-the-organization-director-workforce/08-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Director agent entries to agents.list via bootstrap.sh jq patches</name>
  <files>scripts/bootstrap.sh</files>
  <action>
Insert 4 new jq patch blocks in bootstrap.sh AFTER the existing config patches (after the `del(.commands.gateway)` line, around line 364) and BEFORE the `chmod 444` line (line 368). Each block follows the idempotent pattern: check if agent id exists, skip if present, append if missing.

CRITICAL: Objects in agents.list REPLACE defaults entirely (no deep merge). Every agent entry MUST include ALL needed sub-fields for model, tools, etc.

CRITICAL: Use agent id `business-researcher` (per user decision — NOT business-intelligence).

Add these 4 agent entries:

**automation-supervisor:**
```bash
HAS_AGENT=$(jq -r '.agents.list[] | select(.id == "automation-supervisor") | .id' "$CONFIG_FILE" 2>/dev/null)
if [ -z "$HAS_AGENT" ]; then
  jq '.agents.list += [{
    "id": "automation-supervisor",
    "name": "Automation Supervisor",
    "workspace": "/data/openclaw-workspace/agents/automation-supervisor",
    "default": false,
    "model": {
      "primary": "openrouter/anthropic/claude-sonnet-4-6",
      "fallbacks": ["openrouter/google/gemini-3-flash-preview", "openrouter/auto"]
    },
    "tools": {"profile": "coding"},
    "heartbeat": {"every": "1h", "model": "openrouter/anthropic/claude-haiku-4-5"}
  }]' "$CONFIG_FILE" > "${CONFIG_FILE}.tmp" && mv "${CONFIG_FILE}.tmp" "$CONFIG_FILE"
  echo "[config] Added automation-supervisor agent"
fi
```

**budget-cfo:**
```bash
HAS_AGENT=$(jq -r '.agents.list[] | select(.id == "budget-cfo") | .id' "$CONFIG_FILE" 2>/dev/null)
if [ -z "$HAS_AGENT" ]; then
  jq '.agents.list += [{
    "id": "budget-cfo",
    "name": "Budget CFO",
    "workspace": "/data/openclaw-workspace/agents/budget-cfo",
    "default": false,
    "model": {
      "primary": "openrouter/anthropic/claude-sonnet-4-6",
      "fallbacks": ["openrouter/google/gemini-3-flash-preview", "openrouter/auto"]
    },
    "tools": {"profile": "minimal"},
    "heartbeat": {"every": "4h", "model": "openrouter/anthropic/claude-haiku-4-5"}
  }]' "$CONFIG_FILE" > "${CONFIG_FILE}.tmp" && mv "${CONFIG_FILE}.tmp" "$CONFIG_FILE"
  echo "[config] Added budget-cfo agent"
fi
```

**business-researcher** (per user decision — agent id stays business-researcher):
```bash
HAS_AGENT=$(jq -r '.agents.list[] | select(.id == "business-researcher") | .id' "$CONFIG_FILE" 2>/dev/null)
if [ -z "$HAS_AGENT" ]; then
  jq '.agents.list += [{
    "id": "business-researcher",
    "name": "Business Researcher",
    "workspace": "/data/openclaw-workspace/agents/business-researcher",
    "default": false,
    "model": {
      "primary": "openrouter/anthropic/claude-sonnet-4-6",
      "fallbacks": ["openrouter/google/gemini-3-flash-preview", "openrouter/auto"]
    },
    "tools": {"profile": "minimal"},
    "heartbeat": {"every": "4h", "model": "openrouter/anthropic/claude-haiku-4-5"}
  }]' "$CONFIG_FILE" > "${CONFIG_FILE}.tmp" && mv "${CONFIG_FILE}.tmp" "$CONFIG_FILE"
  echo "[config] Added business-researcher agent"
fi
```

**workflow-worker** (ephemeral, Gemini Flash, no heartbeat):
```bash
HAS_AGENT=$(jq -r '.agents.list[] | select(.id == "workflow-worker") | .id' "$CONFIG_FILE" 2>/dev/null)
if [ -z "$HAS_AGENT" ]; then
  jq '.agents.list += [{
    "id": "workflow-worker",
    "name": "Workflow Worker",
    "workspace": "/data/openclaw-workspace/agents/workflow-worker",
    "default": false,
    "model": {
      "primary": "openrouter/google/gemini-3-flash-preview",
      "fallbacks": ["openrouter/anthropic/claude-haiku-4-5"]
    },
    "tools": {"profile": "minimal"}
  }]' "$CONFIG_FILE" > "${CONFIG_FILE}.tmp" && mv "${CONFIG_FILE}.tmp" "$CONFIG_FILE"
  echo "[config] Added workflow-worker agent"
fi
```

Add a section comment before the block: `# --- Director Agent Registration ---`

DO NOT move or modify the `chmod 444` line. DO NOT touch any existing patches (gateway.mode, remote.url, useAccessGroups, etc.).
  </action>
  <verify>
Run `bash -n scripts/bootstrap.sh` to verify no syntax errors. Then grep for all 4 agent ids:
```
grep -c 'automation-supervisor\|budget-cfo\|business-researcher\|workflow-worker' scripts/bootstrap.sh
```
Expected: at least 8 matches (2 per agent — the check and the insert).

Also verify the chmod 444 line still exists AFTER the new patches:
```
grep -n 'chmod 444' scripts/bootstrap.sh
```
  </verify>
  <done>bootstrap.sh contains idempotent jq patches for all 4 Director agents, positioned between existing config patches and the chmod 444 lock line. No existing patches modified.</done>
</task>

<task type="auto">
  <name>Task 2: Add Director workspace seeding to bootstrap.sh</name>
  <files>scripts/bootstrap.sh</files>
  <action>
After the `seed_agent "main" "OpenClaw"` call (around line 125), add seed_agent calls for each Director. The existing `seed_agent` function already handles non-main agents with a basic SOUL.md stub (lines 117-123), but it creates workspaces at `/data/openclaw-{id}` which is wrong — Directors need workspaces at `/data/openclaw-workspace/agents/{id}`.

Update the `seed_agent` function to support Director agents. Add a condition: if `$id` starts with a known Director prefix OR if a third arg `"director"` is passed, set `dir="/data/openclaw-workspace/agents/$id"` instead of `/data/openclaw-$id`.

Simpler approach: add Director-specific seeding AFTER the `seed_agent "main"` call as a separate block:

```bash
# --- Seed Director Workspaces ---
for DIRECTOR_ENTRY in \
  "automation-supervisor:Automation Supervisor" \
  "budget-cfo:Budget CFO" \
  "business-researcher:Business Researcher" \
  "workflow-worker:Workflow Worker"; do

  DIR_ID="${DIRECTOR_ENTRY%%:*}"
  DIR_NAME="${DIRECTOR_ENTRY#*:}"
  DIR_PATH="${WORKSPACE_DIR}/agents/${DIR_ID}"

  mkdir -p "$DIR_PATH/memory/patterns"

  # SOUL.md stub (seed if missing — Director's own version takes precedence)
  if [ ! -f "$DIR_PATH/SOUL.md" ]; then
    cat > "$DIR_PATH/SOUL.md" <<DIRSOUL
# SOUL.md - ${DIR_NAME}

You are ${DIR_NAME}, a Director in The Organization.
Your workspace is ${DIR_PATH}.
Your session key is hook:${DIR_ID}.

## Identity
You wake up fresh each session. Read memory/patterns/ for continuity.
Write important state to memory files — session context resets daily at 4 AM.

## Communication
- To reach another Director: POST to /hooks with their agentId and sessionKey
- To escalate to Main: POST to main agent session
- Always include both agentId AND sessionKey in hook POSTs

## Memory Protocol
- Before tasks: search memory/patterns/ for relevant prior knowledge
- After tasks: write learnings to memory/patterns/<domain>.md
- Format: ### [title] / Date / Status (WORKS|FAILS|PREFER|AVOID) / Detail
DIRSOUL
    echo "[seed] Created SOUL.md for ${DIR_NAME}"
  fi

  # AGENTS.md — copy from main workspace if available, seed if not
  if [ ! -f "$DIR_PATH/AGENTS.md" ] && [ -f "${WORKSPACE_DIR}/AGENTS.md" ]; then
    cp "${WORKSPACE_DIR}/AGENTS.md" "$DIR_PATH/AGENTS.md"
    echo "[seed] Copied AGENTS.md to ${DIR_NAME} workspace"
  fi
done

# Supervisor-specific directories (schema registry, system health)
mkdir -p "${WORKSPACE_DIR}/agents/automation-supervisor/memory/schemas"
if [ ! -f "${WORKSPACE_DIR}/agents/automation-supervisor/memory/schemas/capabilities.md" ]; then
  cat > "${WORKSPACE_DIR}/agents/automation-supervisor/memory/schemas/capabilities.md" <<CAPEOF
# Capabilities Registry

Maintained by the Automation Supervisor. Lists all available n8n microservices and data feeds.

## Available Feeds
(none yet — feeds are built as Directors request them)

## Available Capabilities
(none yet — capabilities are built on demand)
CAPEOF
  echo "[seed] Created capabilities.md for Automation Supervisor"
fi

if [ ! -f "${WORKSPACE_DIR}/agents/automation-supervisor/memory/SYSTEM_HEALTH.md" ]; then
  cat > "${WORKSPACE_DIR}/agents/automation-supervisor/memory/SYSTEM_HEALTH.md" <<HEALTHEOF
# System Health Log

Running log of infrastructure actions by the Automation Supervisor.
Format: YYYY-MM-DD | ACTION | DETAILS | STATUS
HEALTHEOF
  echo "[seed] Created SYSTEM_HEALTH.md for Automation Supervisor"
fi
```

This block is idempotent — mkdir -p is safe, file creation checks for existence first.
  </action>
  <verify>
Run `bash -n scripts/bootstrap.sh` to verify no syntax errors. Grep for the seeding block:
```
grep -c 'Seed Director Workspaces' scripts/bootstrap.sh
```
Expected: 1
  </verify>
  <done>bootstrap.sh seeds workspace directories with SOUL.md, AGENTS.md, memory/patterns/, and Supervisor-specific files (schemas/capabilities.md, SYSTEM_HEALTH.md) for all 4 Directors. Idempotent — safe on redeploy.</done>
</task>

</tasks>

<verification>
1. `bash -n scripts/bootstrap.sh` — no syntax errors
2. All 4 agent ids appear in bootstrap.sh jq patches
3. Director workspace seeding block exists after `seed_agent "main"`
4. `chmod 444` line is still the LAST config operation (before system services)
5. No changes to gateway.mode, gateway.remote, commands.useAccessGroups, hooks.allowRequestSessionKey
</verification>

<success_criteria>
- bootstrap.sh adds 4 Director agents to agents.list (idempotent)
- bootstrap.sh seeds 4 Director workspaces with SOUL.md, AGENTS.md, memory/patterns/
- Automation Supervisor workspace has memory/schemas/capabilities.md and memory/SYSTEM_HEALTH.md
- All changes are between existing patches and chmod 444 (correct ordering)
- No existing functionality broken
</success_criteria>

<output>
After completion, create `.planning/phases/08-the-organization-director-workforce/08-01-SUMMARY.md`
</output>
